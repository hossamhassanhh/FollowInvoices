<div class="form-container">
    <div class="input-wrapper">
        <label>المورد</label>
        <div class="div-container">
            <input type="text" id="vendor-name" required>
            <button class="btn" onclick="fetchAllVendors()">كل الموردين</button>
        </div>
    </div>
    <div class="button-container">
        <button class="custom-btn" onclick="FilterByRequesterReport()">تنفيذ</button>
        <button class="custom-btn" onclick="GoToQueryMainPage()">الرجوع إلي قائمة التقارير</button>
        <button class="custom-btn" onclick="GoToHomePage()">الرجوع إلي القائمة الرئيسية</button>
    </div>
</div>

<script src="/js/jquery-3.7.1.min.js"></script>

<script type="text/javascript">
    function getElementValue(elementId) {
        const element = document.getElementById(elementId);

        if (!element) {
            console.error(`Element with ID ${elementId} not found.`);
            return null;
        }

        // Check if the element is a select dropdown
        if (element.tagName === 'SELECT') {
            return element.options[element.selectedIndex]?.value || '';
        }
        // Check if the element is an input, textarea, or other input-like element
        else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            return element.value;
        }
        // Handle other cases (e.g., div, span, etc.)
        else {
            console.error(`Unsupported element type: ${element.tagName}`);
            return null;
        }
    }
    function fetchAllVendors() {
        var invoiceInput = document.getElementById('vendor-name');
        var invoiceDropdown = document.createElement('select');
        
        // Perform AJAX call to fetch invoice numbers
        $.ajax({
            url: '/Home/GetAllVendors', // Adjust as per your route
            type: 'GET',
            success: function (response) {
                // Check the length of the response
                if (response.length > 1) {
                    invoiceDropdown.id = invoiceInput.id; // Preserve the ID for compatibility

                    // Add a placeholder option
                    const placeholderOption = document.createElement('option');
                    placeholderOption.value = '';
                    placeholderOption.textContent = '';
                    placeholderOption.disabled = true;
                    placeholderOption.selected = true;
                    invoiceDropdown.appendChild(placeholderOption);

                    // Populate dropdown with invoice numbers
                    response.forEach(invoice => {
                        const option = document.createElement('option');
                        option.value = invoice;
                        option.textContent = invoice;
                        invoiceDropdown.appendChild(option);
                    });

                } else if (response.length === 1) {
                    invoiceDropdown = document.createElement('input');
                    invoiceDropdown.type = 'text';
                    invoiceDropdown.id = invoiceInput.id;
                    // Set the single invoice number as the value of the input field
                    invoiceDropdown.value = response[0];
                } else {
                    invoiceDropdown = document.createElement('input');
                    invoiceDropdown.type = 'text';
                    invoiceDropdown.id = invoiceInput.id;
                    invoiceDropdown.value = '';
                    // No invoice numbers found
                    // console.error('No invoice numbers found for the given ISO number.');
                }
                // Replace the original input with the dropdown
                invoiceInput.parentNode.replaceChild(invoiceDropdown, invoiceInput);
            },
            error: function (xhr, status, error) {
                alert('Error fetching vendor names. Please try again.');
            }
        }
        );        
    }
    function GoToQueryMainPage() {
        var url = '@Url.Action("Query", "Home")';
        window.location.href = url;
    }
    function GoToHomePage() {
        var url = '@Url.Action("Index", "Home")';
        // Redirect to the URL
        window.location.href = url;
    }
    function FilterByRequesterReport() {
        var id = getElementValue("vendor-name");
        var url = '@Url.Action("FilterByVendorReport", "Home")' +
            '?id=' + encodeURIComponent(id);

        // Redirect to the URL
        window.location.href = url;
    }
</script>