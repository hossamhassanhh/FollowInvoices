<style>
    .custom-select-container {
    position: relative;
    width: 100%;
    direction: rtl;
    text-align: right;
    }

    .search-box {
    width: 100%;
    box-sizing: border-box;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    }

    .options-list {
    position: absolute;
    z-index: 10;
    width: 100%;
    max-height: 150px;
    overflow-y: auto;
    background-color: #fff;
    border: 1px solid #ccc;
    border-top: none;
    display: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .options-list div {
    padding: 8px;
    cursor: pointer;
    }

    .options-list div:hover {
    background-color: #f2f2f2;
    }
</style>
<h2>اضافة فاتورة</h2>
<div class="form-container">
    <div class="input-wrapper">
        <label>اسم المستخدم</label>
        <input type="text" id="user-name" value="@User.Identity.Name" disabled/>
    </div>
    <div class="input-wrapper">
        <label>رقم الايزو</label>
        <input type="text" id="iso-number" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" value="@ViewBag.NextIsoNumber" oninput="updateInvoiceNumber()" />
    </div>
    <div class="input-wrapper">
        <label>تاريخ الايزو</label>
        <input type="text" id="iso-date" value="@ViewBag.IsoDate" />
    </div>

    @* <div class="input-wrapper">
        <label>المورد</label>
        <select id="vendor-dropdown" required>
            <option value="">اختر المورد</option>
        </select>
    </div> *@
    <div class="input-wrapper">
        <label>المورد</label>
        <div class="custom-select-container" id="vendor-container">
            @if (!string.IsNullOrEmpty(ViewBag.VendorName))
            {
                <input type="text" id="vendorSearch" value="@ViewBag.VendorName" data-value="@ViewBag.VendorName" disabled required>
            }
            else
            {
                <input type="text" id="vendorSearch" class="search-box" placeholder="اختر المورد..." readonly required />
                <div id="vendorOptions" class="options-list"></div>
            }            
            
        </div> 
        @* @if (!string.IsNullOrEmpty(ViewBag.VendorName))
        {
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    setElementValue(
                        "vendorSearch",
                @Html.Raw(Json.Serialize(ViewBag.VendorName))
                    );
                });
            </script>
        } *@
        
    </div>
    
    <div class="input-wrapper">
        <label>رقم الفاتورة</label>
        <div class="div-container">
            <input type="text" id="invoice-number" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="unicode-bidi: plaintext;" required>
            <button class="btn" onclick="updateInvoiceData()">استعلام</button>
            <button class="btn" onclick="ResetInvoiceData()">ادخال فاتورة جديدة</button>
        </div>
    </div>
    <div class="input-wrapper">
        <label>رقم امر التوريد</label>
        <input type="text" id="po-number" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    </div>
    <div class="input-wrapper">
        <label>مبلغ الفاتورة ١</label>
        <input type="text" id="invoice-value-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" required>
    </div>
    <div class="input-wrapper">
        <label for="currency-1">العملة ١</label>
        <select id="currency-1" required>
            <option value="" selected></option>
            <option value="جنيه مصرى">جنيه مصرى</option>
            <option value="دولار امريكي">دولار امريكي</option>
            <option value="يورو">يورو</option>
            <option value="جنيه استرليني">جنيه استرليني</option>
            <option value="ریال سعودی">ریال سعودی</option>
            <option value="کرونه نرویجی">کرونه نرویجی</option>
            <option value="ین يابانی">ین يابانی</option>
            <option value="درهم اماراتي">درهم اماراتي</option>
        </select>
    </div>
    <div class="input-wrapper">
        <label>مبلغ الفاتورة ٢</label>
        <input type="text" id="invoice-value-2" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" required>
    </div>
    <div class="input-wrapper">
        <label>العملة ٢</label>
        <select id="currency-2" required>
            <option value="" selected></option>
            <option value="جنيه مصرى">جنيه مصرى</option>
            <option value="دولار امريكي">دولار امريكي</option>
            <option value="يورو">يورو</option>
            <option value="جنيه استرليني">جنيه استرليني</option>
            <option value="ریال سعودی">ریال سعودی</option>
            <option value="کرونه نرویجی">کرونه نرویجی</option>
            <option value="ین يابانی">ین يابانی</option>
            <option value="درهم اماراتي">درهم اماراتي</option>
        </select>
    </div>
    <div class="input-wrapper">
        <label>تاريخ الفاتورة</label>
        <input class="input" type="date" id="invoice-date" lang="ar" required>
    </div>
    <div class="input-wrapper">
        <label>تاريخ استلام الفاتورة</label>
        <input class="input" type="date" id="invoice-receipt-date" lang="ar" required>
    </div>   
    <div class="input-wrapper">
        <label>الجهة الطالبة</label>
        <select id="requester" required>
            <option value="" selected></option>
            <option value="إدارة العلاقات العامة">إدارة العلاقات العامة</option>
            <option value="إدارة المشتريات">إدارة المشتريات</option>
            <option value="إدارة المشروعات">إدارة المشروعات</option>
            <option value="إدارة المشروعات ١">إدارة المشروعات ١</option>
            <option value="الادارة الطبية">الادارة الطبية</option>
            <option value="إدارة التشغيل و الصيانة">إدارة التشغيل و الصيانة</option>
            <option value="إدارة الشئون الإدارية">إدارة الشئون الإدارية</option>
            <option value="إدارة الشئون القانونية">إدارة الشئون القانونية</option>
            <option value="إدارة المساحة">إدارة المساحة</option>
            <option value="إدارة تكنولوجيا المعلومات">إدارة تكنولوجيا المعلومات</option>
            <option value="إدارة الشئون المالية">إدارة الشئون المالية</option>
            <option value="إدارة الغطس">إدارة الغطس</option>
            <option value="إدارة الوحدات الديناميكية">إدارة الوحدات الديناميكية</option>
            <option value="إدارة الوحدات الغير ديناميكية">إدارة الوحدات الغير ديناميكية</option>
            <option value="إدارة التخطيط">إدارة التخطيط</option>
            <option value="إدارة الصيانة البرية">إدارة الصيانة البرية</option>
            <option value="إدارة مراقبة وتوكيد الجودة">إدارة مراقبة وتوكيد الجودة</option>
            <option value="إدارة الأعمال البحرية">إدارة الأعمال البحرية</option>
            <option value="إدارة الجمارك">إدارة الجمارك</option>
            <option value="إدارة العلاقات الحكومية">إدارة العلاقات الحكومية</option>
            <option value="مكتب رئيس مجلس الإدارة">مكتب رئيس مجلس الإدارة</option>
            <option value="إدارة الصحة والسلامة المهنية">إدارة الصحة والسلامة المهنية</option>
            <option value="إدارة تنمية الاعمال">إدارة تنمية الاعمال</option>
        </select>
    </div>
    <div class="input-wrapper" id="to-requester-div">
        <label>تاريخ الارسال للجهة الطالبة</label>
        <input class="input" type="date" id="to-requester-date" lang="ar">
    </div>

    <div class="input-wrapper">
        <label for="back-to-vendor">ارجاع فاتورة للمورد</label>
        <select id="back-to-vendor">
            <option value="لا" selected>لا</option>
            <option value="نعم">نعم</option>
        </select>
    </div>

    <div class="input-wrapper" id="to-vendor-div" style="display: none;">
        <label>تاريخ الارسال للمورد</label>
        <input class="input" type="date" id="to-vendor-date" lang="ar">
    </div>

    <div class="input-wrapper">
        <label for="area">الموقع</label>
        <select id="area" required>
            <option value="" selected></option>
            <option value="الرئيسي">الرئيسي</option>
            <option value="المعدية">المعدية</option>
        </select>
    </div>
    <div class="button-container">
        <button class="custom-btn" onclick="RedirectToExecuteCreateAction()">تنفيذ</button>
        <button class="custom-btn" onclick="RedirectToExecuteEditAction()">تعديل</button>
        <button class="custom-btn" onclick="GoToHomePage()">الرجوع إلي القائمة الرئيسية</button>
    </div>
</div>


<script src="/js/jquery-3.7.1.min.js"></script>

<script>
    // Get both elements
    const select = document.getElementById('back-to-vendor');
    const dateDiv = document.getElementById('to-vendor-div');
    
    // Listen for changes in the dropdown
    select.addEventListener('change', function () {
        if (this.value === "نعم") {
            dateDiv.style.display = 'block'; // show div
        } else {
            dateDiv.style.display = 'none'; // hide div
            document.getElementById('to-vendor-date').value = ''; // optional: clear date
        }
    });
</script>

<script type="text/javascript">

    const invoiceNumber = document.getElementById('invoice-number');

    function EmptyField(elementId) {
        var element = document.getElementById(elementId);
        console.log(element);
        if (!element) {
            console.error(`Element with ID ${elementId} not found.`);
            return;
        }

        // Check if the element is a select dropdown
        if (element.tagName === 'SELECT') {
            element.parentNode.replaceChild(invoiceNumber, element);
            console.log(element);
        }
        // Check if the element is an input, textarea, or other input-like element
        else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.value = '';
        }
        // Handle other cases (e.g., div, span, etc.)
        else {
            console.error(`Unsupported element type: ${element.tagName}`);
        }
    }
    // 
    function ResetFieldValue(elementId) {
        var element = document.getElementById(elementId);
        console.log(element);
        if (!element) {
            console.error(`Element with ID ${elementId} not found.`);
            return;
        }

        // Check if the element is a select dropdown
        if (element.tagName === 'SELECT') {
            element.selectedIndex = 0; // Resets to the first option
            console.log(element);
        }
        // Check if the element is an input, textarea, or other input-like element
        else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.value = '';
        }
        // Handle other cases (e.g., div, span, etc.)
        else {
            console.error(`Unsupported element type: ${element.tagName}`);
        }
    }

    function ResetInvoiceData(){
        EmptyField('invoice-number');
        ResetFieldValue('vendor-dropdown');
        ResetFieldValue('invoice-value-1');
        ResetFieldValue('invoice-value-2');
        ResetFieldValue('currency-1');
        ResetFieldValue('currency-2');
        ResetFieldValue('invoice-date');
        ResetFieldValue('invoice-receipt-date');
        ResetFieldValue('requester');
        ResetFieldValue('to-requester-date');
        ResetFieldValue('to-vendor-date');
        ResetFieldValue('area');
    }

    function getElementValue(elementId) {
        const element = document.getElementById(elementId);

        if (!element) {
            console.error(`Element with ID ${elementId} not found.`);
            return null;
        }

        // Check if the element is a select dropdown
        if (element.tagName === 'SELECT') {
            return element.options[element.selectedIndex]?.value || '';
        }
        // Check if the element is an input, textarea, or other input-like element
        else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            return element.value;
        }
        // Handle other cases (e.g., div, span, etc.)
        else {
            console.error(`Unsupported element type: ${element.tagName}`);
            return null;
        }
    }

    function setElementValue(elementId, value) {
        const element = document.getElementById(elementId);

        if (!element) {
            console.error(`Element with ID ${elementId} not found.`);
            return;
        }

        // Check if the element is a select dropdown
        if (element.tagName === 'SELECT') {
            // Loop through options and set the selected option
            for (let option of element.options) {
                if (option.value === value) {
                    option.selected = true;
                    break;
                }
            }
        }
        // Check if the element is an input, textarea, or other input-like element
        else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.value = value;
        }
        // Handle other cases (e.g., div, span, etc.)
        else {
            console.error(`Unsupported element type: ${element.tagName}`);
        }
    }

    function GoToHomePage() {
        var url = '@Url.Action("Index", "Home")';
        window.location.href = url;
    }

    function RedirectToExecuteEditAction() {
        var userName = getElementValue('user-name'); /* document.getElementById('user-name').value; */
        var isoNumber = getElementValue('iso-number');/* document.getElementById('iso-number').value; */
        var isoDate = getElementValue('iso-date');/* document.getElementById('iso-date').value; */
        var invoiceNumber = getElementValue('invoice-number');/* document.getElementById('invoice-number').value; */
        var poNumber = getElementValue('po-number');/* document.getElementById('invoice-number').value; */
        var invoiceValue1 = getElementValue('invoice-value-1');/* document.getElementById('invoice-value-1').value; */
        var invoiceValue2 = getElementValue('invoice-value-2');/* document.getElementById('invoice-value-2').value; */
        var currency1 = getElementValue('currency-1');/* document.getElementById('currency-1').value; */
        var currency2 = getElementValue('currency-2'); /* document.getElementById('currency-2').value; */
        var invoiceDate = getElementValue('invoice-date');/* document.getElementById('invoice-date').value; */
        var invoiceReceiptDate = getElementValue('invoice-receipt-date');/* document.getElementById('invoice-receipt-date').value; */
        var requester = getElementValue('requester');/* document.getElementById('requester').value; */

        // var vendorName = getElementValue('vendor-dropdown');/* document.getElementById('vendor-name').value; */
        var vendorName = getSelectedVendor();

        let toRequesterDate = document.getElementById('to-requester-date').value;
        let toVendorDate = document.getElementById('to-vendor-date').value;
        let area = document.getElementById('area').value;
        
        var url = '@Url.Action("ExecuteEdit", "Home")' +
            '?userName=' + encodeURIComponent(userName) +
            '&isoNumber=' + encodeURIComponent(isoNumber) +
            '&isoDate=' + encodeURIComponent(isoDate) +
            '&invoiceNumber=' + encodeURIComponent(invoiceNumber) +
            '&poNumber=' + encodeURIComponent(poNumber) +
            '&invoiceValue1=' + encodeURIComponent(invoiceValue1) +
            '&invoiceValue2=' + encodeURIComponent(invoiceValue2) +
            '&currency1=' + encodeURIComponent(currency1) +
            '&currency2=' + encodeURIComponent(currency2) +
            '&invoiceDate=' + encodeURIComponent(invoiceDate) +
            '&invoiceReceiptDate=' + encodeURIComponent(invoiceReceiptDate) +
            '&requester=' + encodeURIComponent(requester) +            
            '&vendorName=' + encodeURIComponent(vendorName) +
            '&sendToRequesterDate=' + encodeURIComponent(toRequesterDate) +
            '&sendToVendorDate=' + encodeURIComponent(toVendorDate) +
            '&area=' + encodeURIComponent(area);
            // '&invoiceValues=' + invoiceValues.join(',') +
            // '&currencies=' + currencies.join(',') +
        console.log(url);
        window.location.href = url;
    }

    function RedirectToExecuteCreateAction() {
        var createType = "@ViewBag.ViewName";
        var userName = getElementValue('user-name'); /* document.getElementById('user-name').value; */
        var isoNumber = getElementValue('iso-number');/* document.getElementById('iso-number').value; */
        var isoDate = getElementValue('iso-date');/* document.getElementById('iso-date').value; */
        var invoiceNumber = getElementValue('invoice-number');/* document.getElementById('invoice-number').value; */
        var poNumber = getElementValue('po-number');/* document.getElementById('invoice-number').value; */
        var invoiceValue1 = getElementValue('invoice-value-1');/* document.getElementById('invoice-value-1').value; */
        var invoiceValue2 = getElementValue('invoice-value-2');/* document.getElementById('invoice-value-2').value; */
        var currency1 = getElementValue('currency-1');/* document.getElementById('currency-1').value; */
        var currency2 = getElementValue('currency-2'); /* document.getElementById('currency-2').value; */
        var invoiceDate = getElementValue('invoice-date');/* document.getElementById('invoice-date').value; */
        var invoiceReceiptDate = getElementValue('invoice-receipt-date');/* document.getElementById('invoice-receipt-date').value; */
        var requester = getElementValue('requester');/* document.getElementById('requester').value; */
        // var vendorName = getElementValue('vendor-dropdown');/* document.getElementById('vendor-name').value; */
        var vendorName = getSelectedVendor();
        let sendToRequesterDate = document.getElementById('to-requester-date').value;
        let sendToVendorDate = document.getElementById('to-vendor-date').value;
        let area = document.getElementById('area').value;

        var url = '@Url.Action("ExecuteCreate", "Home")' +
            '?userName=' + encodeURIComponent(userName) +
            '&isoNumber=' + encodeURIComponent(isoNumber) +
            '&isoDate=' + encodeURIComponent(isoDate) +
            '&invoiceNumber=' + encodeURIComponent(invoiceNumber) +
            '&poNumber=' + encodeURIComponent(poNumber) +
            '&invoiceValue1=' + encodeURIComponent(invoiceValue1) +
            '&invoiceValue2=' + encodeURIComponent(invoiceValue2) +
            '&currency1=' + encodeURIComponent(currency1) +
            '&currency2=' + encodeURIComponent(currency2) +
            '&invoiceDate=' + encodeURIComponent(invoiceDate) +
            '&invoiceReceiptDate=' + encodeURIComponent(invoiceReceiptDate) +
            '&requester=' + encodeURIComponent(requester) +
            '&vendorName=' + encodeURIComponent(vendorName) +
            '&sendToRequesterDate=' + encodeURIComponent(sendToRequesterDate) +
            '&sendToVendorDate=' + encodeURIComponent(sendToVendorDate) +
            '&area=' + encodeURIComponent(area) +
            '&createType=' + encodeURIComponent(createType);
        // '&invoiceValues=' + invoiceValues.join(',') +
        // '&currencies=' + currencies.join(',') +

        window.location.href = url;

        // // Construct dynamic invoice values and currencies
        // var exchangeCase = document.getElementById('exchange-case').value; // Number of values (1, 2, or 3)
        // var invoiceValues = [];
        // var currencies = [];

        // for (let i = 1; i <= exchangeCase; i++) {
        //     var valueInput = document.getElementById(`invoice-value-${i}`);
        //     var currencyInput = document.getElementById(`currency-${i}`);

        //     if (valueInput && currencyInput) {
        //         invoiceValues.push(encodeURIComponent(valueInput.value));
        //         currencies.push(encodeURIComponent(currencyInput.value));
        //     }
        // }        
    }

    function updateInvoiceNumber() {
        setElementValue('back-to-vendor', 'لا');
        document.getElementById('to-vendor-div').style.display = 'none';
        var isoNumber = document.getElementById('iso-number').value;
        var invoiceInput = document.getElementById('invoice-number');
        var invoiceDropdown = document.createElement('select');
        ResetFieldValue('invoice-number');
        if (isoNumber) {
            // Perform AJAX call to fetch invoice numbers
            $.ajax({
                url: '/Home/GetInvoiceNumbers', // Adjust as per your route
                type: 'GET',
                data: { isoNumber: isoNumber },
                success: function (response) {                    
                    // Check the length of the response
                    if (response.length > 1) {
                        invoiceDropdown.id = invoiceInput.id; // Preserve the ID for compatibility

                        // Add a placeholder option
                        const placeholderOption = document.createElement('option');
                        placeholderOption.value = '';
                        placeholderOption.textContent = 'Select an invoice';
                        placeholderOption.disabled = true;
                        placeholderOption.selected = true;
                        invoiceDropdown.appendChild(placeholderOption);

                        // Populate dropdown with invoice numbers
                        response.forEach(invoice => {
                            const option = document.createElement('option');
                            option.value = invoice;
                            option.textContent = invoice;
                            invoiceDropdown.appendChild(option);
                        });
                        
                    } else if (response.length === 1) {
                        invoiceDropdown = document.createElement('input');
                        invoiceDropdown.type = 'text';
                        invoiceDropdown.id = invoiceInput.id;
                        // Set the single invoice number as the value of the input field
                        invoiceDropdown.value = response[0];
                    } else {
                        invoiceDropdown = document.createElement('input');
                        invoiceDropdown.type = 'text';
                        invoiceDropdown.id = invoiceInput.id;
                        invoiceDropdown.value = '';
                        // No invoice numbers found
                        // console.error('No invoice numbers found for the given ISO number.');
                    }
                    // Replace the original input with the dropdown
                    invoiceInput.parentNode.replaceChild(invoiceDropdown, invoiceInput);
                },
                error: function (xhr, status, error) {
                    alert('Error fetching invoice numbers. Please try again.');
                }
            });
        } else {
            alert('Please enter a valid ISO number.');
        }
    }

    function updateInvoiceData() {
        console.log('Fetching invoice data...');
        const isoNumber = getElementValue('iso-number');
        const invoiceNumber = getElementValue('invoice-number');
        console.log(isoNumber);
        console.log(invoiceNumber);
        if (invoiceNumber !== '') {
            // Perform AJAX call to fetch invoice details
            console.log("Calling GetInvoiceData function...");
            $.ajax({
                url: '/Home/GetInvoiceData', // Replace with your controller and action
                type: 'GET',
                data: { isoNumber: isoNumber, invoiceNumber: invoiceNumber },
                
                success: function (response) {
                    console.log(@ViewBag.Flag);
                    console.log("Success");
                    // Update fields with the fetched data
                    const responseDetails = response.details;
                    console.log(response);
                    // Use the generic function to set values
                    // ResetFieldValue('currency-1');
                    // ResetFieldValue('currency-2');
                    // ResetFieldValue('invoice-value-1');
                    // ResetFieldValue('invoice-value-2');
                    // ResetFieldValue('vendorSearch');
                    // ResetFieldValue('invoice-date');
                    // ResetFieldValue('invoice-receipt-date');
                    // ResetFieldValue('requester');
                    // ResetFieldValue('to-requester-date');
                    // ResetFieldValue('iso-date');
                    // ResetFieldValue('area');
                    console.log("responseDetails.PONumber" )
                    console.log(responseDetails.PONumber )
                    setElementValue('po-number', responseDetails.poNumber);
                    
         
                    console.log(document.getElementById('po-number'));
                    setElementValue('currency-1', responseDetails.currency1);
                    console.log(responseDetails.currency1 )
                    setElementValue('currency-2', responseDetails.currency2);
                    console.log(responseDetails.currency2 )
                    setElementValue('invoice-value-1', responseDetails.invoiceValue1);
                    setElementValue('invoice-value-2', responseDetails.invoiceValue2);
                    console.log(responseDetails.invoiceValue2 )
                    setElementValue('vendorSearch', responseDetails.vendorName);
                    setElementValue('invoice-date', responseDetails.invoiceDate);
                    setElementValue('invoice-receipt-date', responseDetails.invoiceReceiptDate);
                    setElementValue('requester', responseDetails.requester);
                    console.log(responseDetails.sendToRequesterDate);
                    setElementValue('to-requester-date', responseDetails.sendtoRequesterDate);
                    if (responseDetails.sendtoVendorDate !== '' && responseDetails.sendtoVendorDate !== null)
                    {
                        setElementValue('back-to-vendor', 'نعم');
                        document.getElementById('to-vendor-div').style.display = 'block';
                    }

                    setElementValue('to-vendor-date', responseDetails.sendtoVendorDate);
                    setElementValue('iso-date', responseDetails.isoDate);
                    setElementValue('area', responseDetails.area);                    

                },
                error: function (xhr, status, error) {
                    console.error('Error fetching invoice data:', error);
                    alert('Error fetching invoice data. Please try again.');
                }
            });
        } else {
            alert('رقم الفاتورة غير موجود');
        }
    }

    window.addEventListener("pageshow", function (event) {
        if (event.persisted || window.performance.getEntriesByType("navigation")[0].type === "back_forward") {
            location.reload(); // Forces the page to refresh and clear form values
        }
    });

    $(document).ready(function () {
        populateVendorDropdown();
    });

    function populateVendorDropdown() {
        $.ajax({
            url: '/Home/GetAllVendors',
            type: 'GET',
            success: function (vendors) {
                console.log('checkpoint');
                let vendorDropdown = $("#vendor-dropdown");
                console.log("check vendor list" + vendorDropdown);
                vendorDropdown.empty();  // Clear existing options
                vendorDropdown.append('<option value="">اختر المورد</option>'); // Default option

                vendors.forEach(vendor => {
                    vendorDropdown.append(new Option(vendor, vendor));
                    console.log(vendor);
                });
                console.log(vendorDropdown);
            },
            error: function () {
                console.error('Error fetching vendors.');
            }
        });
    }
        // Global array to hold vendor names
    let vendorList = [];

    function populateVendorDropdown() {
        $.ajax({
            url: '/Home/GetAllVendors',
            type: 'GET',
            success: function (vendors) {
                vendorList = vendors; // Store for filtering
                setupSearchableVendor(vendorList);
            },
            error: function () {
                console.error('Error fetching vendors.');
            }
        });
    }

    function setupSearchableVendor(vendors) {
        const vendorSearch = document.getElementById("vendorSearch");
        const vendorOptions = document.getElementById("vendorOptions");

        // Populate vendor list dynamically
        function renderVendors(filter = "") {
            vendorOptions.innerHTML = "";
            const filtered = vendors.filter(v => v.includes(filter));
            filtered.forEach(v => {
                const div = document.createElement("div");
                div.textContent = v;
                div.onclick = () => {
                    vendorSearch.value = v;
                    vendorSearch.dataset.value = v;
                    vendorOptions.style.display = "none";
                    vendorSearch.setAttribute("readonly", true);
                };
                vendorOptions.appendChild(div);
            });
            vendorOptions.style.display = filtered.length ? "block" : "none";
        }

        // Show options when clicking input
        vendorSearch.addEventListener("click", () => {
            vendorSearch.removeAttribute("readonly");
            renderVendors();
            vendorOptions.style.display = "block";
            vendorSearch.focus();
        });

        // Filter list as user types
        vendorSearch.addEventListener("input", (e) => {
            renderVendors(e.target.value.trim());
        });

        // Hide dropdown when clicking outside
        document.addEventListener("click", (e) => {
            if (!e.target.closest("#vendor-container")) {
                vendorOptions.style.display = "none";
                vendorSearch.setAttribute("readonly", true);
            }
        });
    }

    // Helper to get selected vendor name (to use in your form submission)
    function getSelectedVendor() {
        const input = document.getElementById("vendorSearch");
        return input?.dataset.value || input?.value || "";
    }

</script>